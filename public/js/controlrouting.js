var routeControl=null,showControl=!1,line=null;function convertirKM(a){return 1E3<=a?(a/1E3).toString()+" km":a.toString()+" m"}function borrar(){null!==marker1&&(mapa.removeLayer(marker1),marker1=null);null!==marker2&&(mapa.removeLayer(marker2),marker2=null);waypoints.length=0;coords.length=0;null!==line&&mapa.removeLayer(line)}function borrarRuta(){routeControl.getPlan().setWaypoints([])}
function esconderMostrar(){showControl?(routeControl.hide(),showControl=!1):(routeControl.show(),showControl=!0)}function displayRoutingControl(){null==routeControl&&(crearControlRouting(),showControl=!0)}function removeRouting(){null!=routeControl&&(mapa.removeControl(routeControl),routeControl=null)}
function crearControlRouting(){routeControl=L.Routing.control({router:L.Routing.mapzen("valhalla-A4rESty",{costing:"bicycle"}),formatter:new L.Routing.mapzenFormatter({language:"es"}),plan:L.Routing.plan([],{geocoder:L.Control.Geocoder.nominatim({geocodingQueryParams:{countrycodes:"uy"}}),reverseWaypoints:!0,city:"Montevideo",language:"sp"}),lineOptions:{styles:[{color:"black",opacity:.15,weight:9},{color:"white",opacity:.8,weight:6},{color:"red",opacity:1,weight:4}]},summaryTemplate:"<h2>Trayectoria: {name}</h2><h3>Distancia: {distance}</h3>",
language:"sp",routeWhileDragging:!0,waypointMode:"snap",collapsible:!0}).addTo(mapa)}
function calcRoute(){waypoints.length=0;coords.length=0;waysp.length=0;null!==marker1&&null!==marker2?(waypoints.push({latLng:marker1.getLatLng()}),waypoints.push({latLng:marker2.getLatLng()}),router.route(waypoints,function(a,b){line&&map.removeLayer(line);a?alert(a):(coords=b[0].coordinates,waysp=b[0].waypoints,alert(b[0].summary.totalTime),alert(b[0].summary.totalDistance),line=L.Routing.line(b[0],{styles:[{color:"black",opacity:.15,weight:7},{color:"white",opacity:.8,weight:4},{color:"red",opacity:1,
weight:4}]}).addTo(map))})):alert("Se necesita el par Origen-Destino para calcular la ruta")}
function rutaAB(a,b){var c=[],e=[],f=[];c.length=0;e.length=0;f.length=0;if(null!=a&&null!=b){var d=L.Routing.waypoint(a),g=L.Routing.waypoint(b);c.push(d);c.push(g);d=null;d=L.Routing.mapzen({addWaypoints:!1});d.route(c,function(a,c){line&&mapa.removeLayer(line);if(a)console.log(a);else{e=c[0].coordinates;f=c[0].waypoints;line=L.Routing.line(c[0],{styles:[{color:"black",opacity:.15,weight:7},{color:"white",opacity:.8,weight:4},{color:"#1652F4",opacity:1,weight:3}]}).addTo(mapa);var d=convertirKM(c[0].summary.totalDistance);
popup=L.popup({offset:L.point(0,-30)}).setLatLng(b).setContent("<p>Distancia: <b>"+d+"</b></p>").openOn(mapa)}})}else alert("Se necesita el par Origen-Destino para calcular la ruta")};